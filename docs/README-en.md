# Log Reader for Laravel Applications

[![Latest Version on Packagist](https://img.shields.io/packagist/v/fcno/log-reader.svg?style=flat-square)](https://packagist.org/packages/fcno/log-reader)
[![GitHub Tests Action Status](https://img.shields.io/github/workflow/status/fcno/log-reader/run-tests?label=tests)](https://github.com/fcno/log-reader/actions?query=workflow%3Arun-tests+branch%3Amain)
[![GitHub Code Style Action Status](https://img.shields.io/github/workflow/status/fcno/log-reader/Check%20&%20fix%20styling?label=code%20style)](https://github.com/fcno/log-reader/actions?query=workflow%3A"Check+%26+fix+styling"+branch%3Amain)
[![Total Downloads](https://img.shields.io/packagist/dt/fcno/log-reader.svg?style=flat-square)](https://packagist.org/packages/fcno/log-reader)

---

[English](/docs/README-en.md) 🔹 [Português](/)

---

Daily log file reader for **[Laravel](https://laravel.com/docs)** applications.

In addition to the primary function, this package offers pagination for both, content and log files, as well a transparent line-by-line reading, making it possible to work with large files without loading them entirely into memory.

```php
use Fcno\LogReader\Facades\RecordReader;

RecordReader::from(disk: 'file_system_name')
            ->infoAbout(log_file: 'filename.log')
            ->get();
```

&nbsp;

---

## Table of contents

1. [Notes](#notes)

2. [Requirements](#requirements)

3. [Installation](#installation)

4. [How it works](#how-it-works)

    1. [LogReader](#fcnologReaderfacadeslogreader)

    2. [RecordReader](#fcnologReaderfacadesrecordreader)

    3. [SummaryReader](#fcnologReaderfacadessummaryreader)

5. [Testing and Continuous Integration](#testing-and-continuous-integration)

6. [Changelog](#changelog)

7. [Contribution](#contribution)

8. [Security Vulnerabilities](#security-vulnerabilities)

9. [Support and Updates](#support-and-updates)

10. [Credits](#credits)

11. [Thanks](#thanks)

12. [License](#license)

---

## Notes

⭐ This package is intended for reading **[daily log](https://laravel.com/docs/8.x/logging#configuring-the-single-and-daily-channels)** files generated by **[Laravel](https://laravel.com/docs)** applications. Using it for reading other types can (and will) give erroneous results.

⭐ This package does not provide **[views](https://laravel.com/docs/8.x/views)**, as it is a feature that would, in practice, be little used, given the personal preferences of each one. Therefore, the implementation of views is up to the application developer.

⬆️ [Back](#table-of-contents)

&nbsp;

## Requirements

PHP ^8.0

For a full requirements check: [check-platform-reqs](https://getcomposer.org/doc/03-cli.md#check-platform-reqs):

1. Via [Composer](https://getcomposer.org/doc/03-cli.md#check-platform-reqs)

    ```bash
    composer require fcno/log-reader
    composer check-platform-reqs
    ```

2. Via [GitHub Dependencies](../../network/dependencies)

⬆️ [Back](#table-of-contents)

&nbsp;

## Installation

1. Set up a **custom channel** to define fields and delimiters for records in a daily log file

    ```php
    // config/logging.php

    'channels' => [
        ...
        'custom' => [
            'driver' => 'daily',
            'path' => storage_path('logs/laravel.log'),
            'level' => env('LOG_LEVEL', 'debug'), // according to your need
            'days' => 30,                         // according to your need
            'formatter' => Monolog\Formatter\LineFormatter::class,
            'formatter_with' => [
                'format' => "#@#%datetime%|||%channel%|||%level_name%|||%message%|||%context%|||%extra%@#@\n",
                'dateFormat' => 'd-m-Y H:i:s',
            ],
        ],
    ],
    ```

    &nbsp;

2. Set the **LOG_CHANNEL** env variable to use the channel created

    ```php
    // .env
    LOG_CHANNEL=custom
    ```

    &nbsp;

3. Define and set up the disk where log files are stored

    ```php
    // config/filesystems.php

    'disks' => [
        // ...
        'disk_name' => [
            'driver' => 'local',
            'root' => storage_path('logs'), // according to your need
        ],
    ],
    ```

    &nbsp;

4. Install package via **[composer](https://getcomposer.org/)**:

    ```bash
    composer require fcno/log-reader
    ```

⬆️ [Back](#table-of-contents)

&nbsp;

## How it works

This package exposes three ways to interact with log files, each through a **[Facade](https://laravel.com/docs/8.x/facades)** with specific goals:

&nbsp;

1. ### **Fcno\LogReader\Facades\LogReader**

    Responsible for manipulating the files (in the pattern **laravel-yyyy-mm-dd.log**), without reading their content.

    ✏️ **from**

    Signature and usage: tells package which disk the application stores log files on

    ```php
    use Fcno\LogReader\Facades\LogReader;

    /**
     * @param string $disk File System log disk name
     * 
     * @return static
     */
    LogReader::from(disk: 'disk_name');
    ```

    &nbsp;

    Return: Instance of class **LogReader**

    &nbsp;

    ✏️ **get**

    Signature and Usage: All log files on disk

    ```php
    use Fcno\LogReader\Facades\LogReader;

    /**
     * @throws \Fcno\LogReader\Exceptions\FileSystemNotDefinedException
     * 
     * @return \Illuminate\Support\Collection
     */
    LogReader::from(disk: 'disk_name')
                ->get();
    ```

    &nbsp;

    Return: **[Collection](https://laravel.com/docs/8.x/collections)** with all log files on disk informed sorted from newest to oldest

    ```php
    // \Illuminate\Support\Collection;
    [
        0 => "laravel-2021-12-27.log",
        1 => "laravel-2021-12-26.log",
        2 => "laravel-2021-12-25.log",
        3 => "laravel-2021-12-24.log",
        4 => "laravel-2021-12-23.log",
        5 => "laravel-2021-12-22.log",
        6 => "laravel-2021-12-21.log",
        7 => "laravel-2021-12-20.log",
        8 => "laravel-2021-12-19.log",
        9 => "laravel-2021-12-18.log",
        // ...
    ]
    ```

    &nbsp;

    ✏️ **paginate**

    Signature and usage: 5 log files from page 2, ie 6th to 10th files

    ```php
    use Fcno\LogReader\Facades\LogReader;

    /**
     * @param int  $page page number
     * @param int  $per_page items per page
     * 
     * @throws \Fcno\LogReader\Exceptions\InvalidPaginationException
     * @throws \Fcno\LogReader\Exceptions\FileSystemNotDefinedException
     * 
     * @return \Illuminate\Support\Collection
     */
    LogReader::from(disk: 'disk_name')
                ->paginate(page: 2, per_page: 5);
    ```

    &nbsp;

    Return: **[Collection](https://laravel.com/docs/8.x/collections)** paged with data in the same format as the **get** method

    > It will return an empty **[Collection](https://laravel.com/docs/8.x/collections)** or with a smaller number of items than expected, if the list of files has already reached its end.

    &nbsp;

    🚨 **Exceptions**:

    - Method **get** throws:

        - **\Fcno\LogReader\Exceptions\FileSystemNotDefinedException** if the method is called without previously set the **disk** of the **File System**

    - Method **paginate** throws:

        - **\Fcno\LogReader\Exceptions\InvalidPaginationException** if **$page** or **$per_page** are less than 1

        - **\Fcno\LogReader\Exceptions\FileSystemNotDefinedException** if the method is called without previously set the **disk** of the **File System**

    ⬆️ [Back](#table-of-contents)

    &nbsp;

    ---

    &nbsp;

2. ### **Fcno\LogReader\Facades\RecordReader**

    Responsible for reading the contents (records) from the log file.

    The record is the name given to the set of information that was added to the log in order to record data about an event of interest.

    A log file can contain one or more records and, given its infinity, can be paged at the discretion of the application developer.

    ✏️ **from**

    Signature and usage: tells package which disk the application stores log files on

    ```php
    use Fcno\LogReader\Facades\RecordReader;

    /**
     * @param string $disk File System log disk name
     * 
     * @return static
     */
    RecordReader::from(disk: 'disk_name');
    ```

    &nbsp;

    Return: Instance of class **RecordReader**

    &nbsp;

    ✏️ **infoAbout**

    Signature and usage: tells package which log file should be worked on

    ```php
    use Fcno\LogReader\Facades\RecordReader;

    /**
     * @param string  $log_file name of the log file that will be worked on
     * 
     * @throws \Fcno\LogReader\Exceptions\FileNotFoundException
     * @throws \Fcno\LogReader\Exceptions\NotDailyLogException
     * @throws \Fcno\LogReader\Exceptions\FileSystemNotDefinedException
     * 
     * @return static
     */
    RecordReader::from(disk: 'disk_name')
                ->infoAbout(log_file: 'filename.log');
    ```

    &nbsp;

    Return: Instance of class **RecordReader**

    &nbsp;

    ✏️ **get**

    Signature and Usage: All log file records

    ```php
    use Fcno\LogReader\Facades\RecordReader;

   /**
     * @throws \Fcno\LogReader\Exceptions\FileSystemNotDefinedException
     * 
     * @return \Illuminate\Support\Collection
     */
    RecordReader::from(disk: 'disk_name')
                ->infoAbout(log_file: 'filename.log')
                ->get();
    ```

    &nbsp;

    Return: **[Collection](https://laravel.com/docs/8.x/collections)** with all log file records

    ```php
    // \Illuminate\Support\Collection;
    [
        "date" => "2021-12-27",
        "time" => "03:05:08",
        "env" => "production",
        "level" => "emergency",
        "message" => "Lorem ipsum dolor sit amet.",
        "context" => "Donec ultrices ex libero, ut euismod dui vulputate et. Quisque et vestibulum eros, quis dapibus ipsum.",
        "extra" => ""
    ],
    [
        "date" => "2021-12-27",
        "time" => "04:05:08",
        "env" => "local",
        "level" => "info",
        "message" => "Donec imperdiet dapibus facilisis.",
        "context" => "Integer sollicitudin, mauris sit amet luctus finibus, arcu lorem fringilla velit, eget scelerisque ex metus in ante.",
        "extra" => "velit"
    ]
    ```

    &nbsp;

    ✏️ **paginate**

    Signature and usage: 5 records from page 2 of the log file, ie 6th to 10th

    ```php
    use Fcno\LogReader\Facades\RecordReader;

    /**
     * @param int  $page page number
     * @param int  $per_page items per page
     * 
     * @throws \Fcno\LogReader\Exceptions\InvalidPaginationException
     * @throws \Fcno\LogReader\Exceptions\FileSystemNotDefinedException
     * 
     * @return \Illuminate\Support\Collection
     */
    RecordReader::from(disk: 'disk_name')
                ->infoAbout(log_file: 'filename.log')
                ->paginate(page: 2, per_page: 5);
    ```

    &nbsp;

    Return: **[Collection](https://laravel.com/docs/8.x/collections)** paged with data in the same format as the **get** method

    > It will return an empty **[Collection](https://laravel.com/docs/8.x/collections)** or with a smaller number of items than expected, if the list of files has already reached its end.
    >
    > The records are displayed in the order they are written to the file. There is no sorting done by this package.

    &nbsp;

    🚨 **Exceptions**:

    - Method **infoAbout** throws:

        - **Fcno\LogReader\Exceptions\FileNotFoundException** if the file is not found;

        - **Fcno\LogReader\Exceptions\NotDailyLogException** if the file is not in the pattern **laravel-yyy-mm-dd.log**.

        - **\Fcno\LogReader\Exceptions\FileSystemNotDefinedException** if the method is called without previously set the **disk** of the **File System**

    - Method **get** throws:

        - **\Fcno\LogReader\Exceptions\FileSystemNotDefinedException** if the method is called without previously set the **disk** of the **File System**

    - Method **paginate** throws:

        - **\Fcno\LogReader\Exceptions\InvalidPaginationException** if **$page** or **$per_page** are less than 1

        - **\Fcno\LogReader\Exceptions\FileSystemNotDefinedException** if the method is called without previously set the **disk** of the **File System**

    ⬆️ [Back](#table-of-contents)

    &nbsp;

    ---

    &nbsp;

3. ### **Fcno\LogReader\Facades\SummaryReader**

    Responsible for reading the content (records) from the log file and generating a summary.

    The summary is the name given to the count of records by level, ie, the amount of records of the type **debug**, **info**, **notice** etc.

    &nbsp;

    ✏️ **from**

    Signature and usage: tells package which disk the application stores log files on

    ```php
    use Fcno\LogReader\Facades\SummaryReader;

    /**
     * @param string $disk File System log disk name
     * 
     * @return static
     */
    SummaryReader::from(disk: 'disk_name');
    ```

    &nbsp;

    Return: Instance of class **SummaryReader**

    &nbsp;

    ✏️ **infoAbout**

    Signature and usage: tells package which log file should be worked on

    ```php
    use Fcno\LogReader\Facades\SummaryReader;

    /**
     * @param string  $log_file name of the log file that will be worked on
     * 
     * @throws \Fcno\LogReader\Exceptions\FileNotFoundException
     * @throws \Fcno\LogReader\Exceptions\NotDailyLogException
     * @throws \Fcno\LogReader\Exceptions\FileSystemNotDefinedException
     * 
     * @return static
     */
    SummaryReader::from(disk: 'disk_name')
                    ->infoAbout(log_file: 'filename.log');
    ```

    &nbsp;

    ✏️ **get**

    Signature and Usage: Summary of all log file records as well as their date

    ```php
    use Fcno\LogReader\Facades\SummaryReader;

   /**
     * @throws \Fcno\LogReader\Exceptions\FileSystemNotDefinedException
     * 
     * @return \Illuminate\Support\Collection
     */
    SummaryReader::from(disk: 'disk_name')
                    ->infoAbout(log_file: 'filename.log')
                    ->get();
    ```

    &nbsp;

    Return: **[Collection](https://laravel.com/docs/8.x/collections)** with the summary of all records of the log file informed as well as their date, that is, the amount of occurrences of the various log levels present in the file, as well as the date of their occurrences

    ```php
    // \Illuminate\Support\Collection;
    [
        "alert" => 5,
        "debug" => 10,
        "date" => "2021-12-27"
    ],
    [
        "emergency" => 1,
        "info" => 5,
        "warning" => 10,
        "date" => "2021-12-26"
    ]
    ```

    &nbsp;

    > This *package* does not have embedded in its code the need for the application's log levels to adhere to **[PSR-3](https://www.php-fig.org/psr/psr-3/)* *. However, it is considered good practice to implement this type of pattern in the application.
    >
    > Levels that do not have records will not be returned (counted) in the Collection.
    >
    > The date, in the pattern **yyyy-mm-dd**, returned is the one present in the first record. It is assumed that all logs in the file were generated on the same day as this *package* is for daily logs.

    &nbsp;

    🚨 **Exceptions**:

    - Method **infoAbout** throws:

        - **Fcno\LogReader\Exceptions\FileNotFoundException** if the file is not found;

        - **Fcno\LogReader\Exceptions\NotDailyLogException** if the file is not in the pattern **laravel-yyy-mm-dd.log**.

        - **\Fcno\LogReader\Exceptions\FileSystemNotDefinedException** if the method is called without previously set the **disk** of the **File System**

    - Method **get** throws:

        - **\Fcno\LogReader\Exceptions\FileSystemNotDefinedException** if the method is called without previously set the **disk** of the **File System**

    ⬆️ [Back](#table-of-contents)

    &nbsp;

## Testing and Continuous Integration

```bash
composer analyse
composer test
composer test-coverage
```

⬆️ [Back](#table-of-contents)

&nbsp;

## Changelog

Please see the [CHANGELOG](CHANGELOG.md) for more information on what has changed in each release.

⬆️ [Back](#table-of-contents)

&nbsp;

## Contribution

Please see [CONTRIBUTING](.github/CONTRIBUTING.md) for details.

⬆️ [Back](#table-of-contents)

&nbsp;

## Security Vulnerabilities

Please see our [security policy](../../security/policy) on how to report security vulnerabilities.

⬆️ [Back](#table-of-contents)

&nbsp;

## Support and Updates

The latest version will be supported and updated as needed. The others will only receive updates to fix [security vulnerabilities](#security-vulnerabilities) for up to 06 months after it has been replaced by a new version.

🐛 Found a bug?!?! Open a **[issue](../../issues/new)**.

✨ Any new ideas?!?! Start [a discussion](../../discussions/new?category=ideas).

⬆️ [Back](#table-of-contents)

&nbsp;

## Credits

- [Fábio Cassiano](https://github.com/fcno)

- [All Contributors](../../contributors)

⬆️ [Back](#table-of-contents)

&nbsp;

## Thanks

👋 Thanks to the people and organizations below for taking the time to build open-source projects that were used in this **Package**.

- ❤️ [Laravel](https://github.com/laravel) for the  **packages**:

  - [illuminate/collections](https://github.com/illuminate/collections)

  - [illuminate/contracts](https://github.com/illuminate/contracts)

  - [illuminate/filesystem](https://github.com/illuminate/filesystem)

  - [illuminate/support](https://github.com/illuminate/support)

- ❤️ [Spatie](https://github.com/spatie) for the **packages**:

  - [spatie/package-skeleton-laravel](https://github.com/spatie/package-skeleton-laravel)

  - [spatie/laravel-package-tools](https://github.com/spatie/laravel-package-tools)

  - [spatie/laravel-ray](https://github.com/spatie/laravel-ray)

- ❤️ [Orchestra Platform](https://github.com/orchestral) for the **package** [orchestral/testbench](https://github.com/orchestral/testbench)

- ❤️ [Nuno Maduro](https://github.com/FakerPHP) for the **packages**:

  - [nunomaduro/collision](https://github.com/nunomaduro/collision)

  - [nunomaduro/larastan](https://github.com/nunomaduro/larastan)

- ❤️ [PEST](https://github.com/pestphp) for the **packages**:

  - [pestphp/pest](https://github.com/pestphp/pest)

  - [pestphp/pest-plugin-laravel](https://github.com/pestphp/pest-plugin-laravel)

- ❤️ [Benjamin Cremer](https://github.com/bcremer) for the **package** [bcremer/LineReader](https://github.com/bcremer/LineReader)

- ❤️ [Jordi Boggiano](https://github.com/Seldaek) for the **package** [Seldaek/monolog](https://github.com/Seldaek/monolog)

- ❤️ [Sebastian Bergmann](https://github.com/sebastianbergmann) for the **package** [sebastianbergmann/phpunit](https://github.com/sebastianbergmann/phpunit)

- ❤️ [FakerPHP](https://github.com/FakerPHP) for the **package** [FakerPHP/Faker](https://github.com/FakerPHP/Faker)

- ❤️ [PHPStan](https://github.com/phpstan) for the **packages**:

  - [phpstan/phpstan](https://github.com/phpstan/phpstan)

  - [phpstan/phpstan-deprecation-rules](https://github.com/phpstan/phpstan-deprecation-rules)

  - [phpstan/phpstan-phpunit](https://github.com/phpstan/phpstan-phpunit)

💸 Some of these people or organizations have some products/services that can be purchased. If you can help them by purchasing one of them or becoming a sponsor, even for a short period, it will help the entire **open-source** community to continue developing solutions for everyone.

⬆️ [Back](#table-of-contents)

&nbsp;

## License

The MIT License (MIT). Please see **[License File](LICENSE.md)** for more information.

⬆️ [Back](#table-of-contents)
